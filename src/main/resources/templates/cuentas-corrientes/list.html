<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" layout:decorate="~{layout}">

<head>
    <title>Cuentas Corrientes</title>
</head>

<body>
    <div layout:fragment="breadcrumbs">
        <nav class="flex" aria-label="Breadcrumb">
            <ol class="inline-flex items-center space-x-1 md:space-x-3">
                <li class="inline-flex items-center">
                    <a href="/" class="inline-flex items-center text-sm font-medium text-gray-700 hover:text-green-600">
                        <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path
                                d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z">
                            </path>
                        </svg>
                        Inicio
                    </a>
                </li>
                <li aria-current="page">
                    <div class="flex items-center">
                        <svg class="w-6 h-6 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd"
                                d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z"
                                clip-rule="evenodd"></path>
                        </svg>
                        <span class="ml-1 text-sm font-medium text-gray-500 md:ml-2">Cuentas Corrientes</span>
                    </div>
                </li>
            </ol>
        </nav>
    </div>

    <div layout:fragment="content">
        <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6">
            <div>
                <h1 class="text-2xl font-bold text-gray-800">Cuentas Corrientes</h1>
                <p class="text-sm text-gray-500 mt-1">Estado de cuentas de clientes</p>
            </div>
        </div>

        <!-- KPIs -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
            <div class="bg-red-50 border border-red-200 rounded-lg p-5">
                <p class="text-xs font-semibold text-red-600 uppercase mb-1">Total Adeudado</p>
                <p class="text-2xl font-bold text-red-700"
                    th:text="${'$' + #numbers.formatDecimal(totalAdeudado, 0, 'COMMA', 2, 'POINT')}">$0</p>
                <p class="text-xs text-red-400 mt-1">Cuentas con saldo positivo</p>
            </div>
            <div class="bg-orange-50 border border-orange-200 rounded-lg p-5">
                <p class="text-xs font-semibold text-orange-600 uppercase mb-1">En Mora</p>
                <p class="text-2xl font-bold text-orange-700" th:text="${enMora}">0</p>
                <p class="text-xs text-orange-400 mt-1">Clientes sobre límite de crédito</p>
            </div>
            <div class="bg-green-50 border border-green-200 rounded-lg p-5">
                <p class="text-xs font-semibold text-green-600 uppercase mb-1">A Favor</p>
                <p class="text-2xl font-bold text-green-700" th:text="${aSaldo}">0</p>
                <p class="text-xs text-green-400 mt-1">Clientes con saldo a su favor</p>
            </div>
        </div>

        <!-- Tabla cuentas -->
        <div class="bg-white shadow-md rounded-lg overflow-hidden" th:if="${!#lists.isEmpty(cuentas)}">
            <div class="overflow-x-auto">
                <table class="min-w-full">
                    <thead class="bg-gradient-to-r from-gray-100 to-gray-200 text-gray-600 uppercase text-xs">
                        <tr>
                            <th class="py-3 px-5 text-left">Cliente</th>
                            <th class="py-3 px-5 text-right">Saldo Actual</th>
                            <th class="py-3 px-5 text-right">Límite Crédito</th>
                            <th class="py-3 px-5 text-center">Estado</th>
                            <th class="py-3 px-5 text-left">Último Mov.</th>
                            <th class="py-3 px-5 text-center">Acciones</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-gray-100">
                        <tr th:each="cuenta : ${cuentas}" class="hover:bg-gray-50 transition-colors">
                            <td class="py-3 px-5">
                                <p class="font-semibold text-gray-800 hover:text-green-600 cursor-pointer"
                                    th:onclick="'openRemoteModal(\'/cuentas-corrientes/' + ${cuenta.id} + '\')'"
                                    th:text="${cuenta.cliente.nombre}"></p>
                                <p class="text-xs text-gray-400" th:text="${cuenta.cliente.cuit}"></p>
                            </td>
                            <td class="py-3 px-5 text-right">
                                <span class="font-bold text-lg"
                                    th:classappend="${cuenta.saldo > 0 ? 'text-red-600' : cuenta.saldo < 0 ? 'text-green-600' : 'text-gray-500'}"
                                    th:text="${(cuenta.saldo < 0 ? '+$' : cuenta.saldo > 0 ? '-$' : '$') + #numbers.formatDecimal(T(java.lang.Math).abs(cuenta.saldo), 0, 'COMMA', 2, 'POINT')}">$0</span>
                                <p class="text-xs text-gray-400"
                                    th:text="${cuenta.saldo > 0 ? 'debe' : cuenta.saldo < 0 ? 'a favor' : 'sin deuda'}">
                                </p>
                            </td>
                            <td class="py-3 px-5 text-right text-gray-600"
                                th:text="${cuenta.limiteCredito > 0 ? '$' + #numbers.formatDecimal(cuenta.limiteCredito, 0, 'COMMA', 2, 'POINT') : 'Sin límite'}">
                            </td>
                            <td class="py-3 px-5 text-center">
                                <span th:if="${cuenta.limiteCredito > 0 and cuenta.saldo > cuenta.limiteCredito}"
                                    class="px-2 py-1 bg-red-100 text-red-700 rounded-full text-xs font-bold">EN
                                    MORA</span>
                                <span th:if="${cuenta.saldo <= 0}"
                                    class="px-2 py-1 bg-green-100 text-green-700 rounded-full text-xs font-bold">AL
                                    DÍA</span>
                                <span
                                    th:if="${cuenta.saldo > 0 and (cuenta.limiteCredito == 0 or cuenta.saldo <= cuenta.limiteCredito)}"
                                    class="px-2 py-1 bg-yellow-100 text-yellow-700 rounded-full text-xs font-bold">ADEUDA</span>
                            </td>
                            <td class="py-3 px-5 text-sm text-gray-500"
                                th:text="${cuenta.fechaUltimoMovimiento != null ? #temporals.format(cuenta.fechaUltimoMovimiento, 'dd/MM/yyyy') : 'Sin movimientos'}">
                            </td>
                            <td class="py-3 px-5 text-center">
                                <a href="javascript:void(0)"
                                    th:onclick="'openRemoteModal(\'/cuentas-corrientes/' + ${cuenta.id} + '\')'"
                                    class="w-8 h-8 flex items-center justify-center rounded-full bg-blue-100 text-blue-600 hover:bg-blue-200 transition-colors"
                                    title="Ver Detalles">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                                    </svg>
                                </a>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div th:if="${#lists.isEmpty(cuentas)}" class="text-center py-16 bg-white rounded-lg shadow">
            <svg class="w-16 h-16 mx-auto text-gray-300 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z" />
            </svg>
            <p class="text-gray-500 mb-2">No hay cuentas corrientes registradas.</p>
            <p class="text-sm text-gray-400">Las cuentas se crean desde el perfil de cada cliente.</p>
        </div>
    </div>
</body>

</html>